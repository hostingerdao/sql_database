--1------------------------------------------------------------------------------------------------
create table ChiNhanh (
	MaCN int primary key, 
	TenCN varchar(15) unique,
	SoFax varchar(11) ,
	DiaChi varchar(10), 
	MaNVTruong varchar(10),
  CONSTRAINT format_Chinhanh_SoFax      
      CHECK ( REGEXP_LIKE ( SoFax, '^\d{10,11}$' ) )
);
Insert into chinhanh values(1, 'phuoc thien', '12345678900', 'thanh p', 'matruong');
Delete chinhanh where MaCN = '1';
--1 end------------------------------------------------------------------------------------------------

--2------------------------------------------------------------------------------------------------
create table ChiNhanhSDT (
	MaCN int primary key, 
	SDT varchar(11),
	constraint fk_ChiNhanhSDT_ChiNhanh_MaCN foreign key(MaCN) references ChiNhanh(MaCN) on delete cascade,
  constraint format_ChinhanhSDT_SDT check (REGEXP_LIKE(SDT, '^\d{10,11}$'))
	);
insert into chinhanhsdt values('1', '1234567899');
--2 end------------------------------------------------------------------------------------------------


--3------------------------------------------------------------------------------------------------
create table NhanVien (
MaNV int primary key, 
HoTen varchar(30), 
NgaySinh date, 
CMND varchar(12) not null unique, 
Email varchar(30), 
SDT varchar(11), 
NamVao char(4), 
ChucVu varchar(30), 
Luong decimal(10), 
DiaChi varchar(30),
MaCN int,
constraint fk_NhanVien_ChiNhanh_MaCN foreign key (MaCN) references Chinhanh(macn) on delete set null,
constraint format_Nhanvien_cmnd check (regexp_like(cmnd,'^\d{9}|\d{11}')),
constraint format_Nhanvien_email check(regexp_like(email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+')),
constraint format_Nhanvien_SDT check (REGEXP_LIKE(SDT, '^\d{10,11}$')),
constraint format_Nhanvien_namvao check(namvao > '1900' and regexp_like(namvao, '^\d{4}$') )
);

ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MM-YYYY';

Insert into nhanvien  ( manv,HoTen, NgaySinh, CMND, Email, SDT, NamVao, ChucVu, Luong, DiaChi,MaCN) 
values (seq_MaNhanVien.NEXTVAL,'Nguyen Van A', '11-11-1990', '123456789','nguyenvana@gmai.com', '0912345678', '1991', 'nhan vien',700000, 'Binh Dinh', 1 );

Insert into nhanvien  ( HoTen, NgaySinh, CMND, Email, SDT, NamVao, ChucVu, Luong, DiaChi,MaCN) 
values ('Nguyen Van B', '11-11-1990', '123456793','nguyenvana@gmai.com', '0912345678', '1991', 'nhan vien',700000, 'Binh Dinh', 1 );

Drop table nhanvien;
----doi tuoi lao dong phai lon hon 18

create sequence seq_MaNhanVien
minvalue 1
start with 1
increment by 1;
--3 end------------------------------------------------------------------------------------------------


--4-----------------------------------------------------------------------------------------------------
create table DoiTac (
MaDT int primary key,
Ten varchar(30) not null unique, 
HoTenNLL varchar(30) not null, 
SDTNLL varchar(11), 
DiaChi varchar(30), 
MaNV int,
constraint fk_doitac_nhanvien_manv foreign key(manv) references nhanvien(manv) on delete set null,
constraint format_doitac_SDTNLL check (REGEXP_LIKE(SDTNLL, '^\d{10,11}$'))
);

create  sequence seq_MaDoiTac
minvalue 1
start with 1
maxvalue 1000
cache 10
increment by 1;

insert into DoiTac values(seq_MaDoiTac.nextval, 'Agribank Binh Duong', 'Truong Quang Dieu', '0123456789', 'binh dinh, nghia binh', 1);
insert into DoiTac values(888, 'Agribank Thuan Hoa 2', 'Truong Quang Sang', '0123456789', 'binh dinh, nghia binh', 1);
--4 end ------------------------------------------------------------------------------------------------


--5-----------------------------------------------------------------------------------------------------
create table NhanVienBH (
MaNV int primary key, 
TongDoanhSo int default 0,
constraint fk_Nhanvienbh_nhanvien_manv foreign key(Manv) references nhanvien(manv) on delete cascade
);

insert into nhanvienbh (manv) values (2);
--5 end ------------------------------------------------------------------------------------------------


--6-----------------------------------------------------------------------------------------------------
create table DoanhSoThang (
MaNV int, 
Nam int , 
Thang int , 
DoanhSo int default 0,
primary key (Manv,nam, thang),
constraint fk_doanhsothang_nhanvien_manv foreign key(manv) references nhanvien(manv) on delete cascade,
constraint format_doanhsothang_thang check( thang > 0 and thang < 13),
constraint format_doandsothang_nam check( nam > 1900 and nam < 10000)
);

insert into doanhsothang (manv, nam, thang) values(2, 2012, 4);
--6 end ------------------------------------------------------------------------------------------------


--7-----------------------------------------------------------------------------------------------------
create table TinDang (
MaTin varchar(20) primary key, 
ThoiGianBD date, 
ThoiGianKT date
);
drop table tindang;
CREATE SEQUENCE seq_matindang_KH
START WITH 1
maxvalue 99999999
INCREMENT BY 1
cache 10;

CREATE SEQUENCE seq_matindang_CT
START WITH 1
maxvalue 99999999
INCREMENT BY 1
cache 10;

insert into tindang values('CT12345689', '10-10-2012', '10-10-2013');

--7 end ------------------------------------------------------------------------------------------------






CREATE OR REPLACE TRIGGER matindang_insert
BEFORE INSERT ON UserTable
FOR EACH ROW

BEGIN
  SELECT 'user' || to_char(usertable_seq.NEXTVAL, '0000099')
  INTO   :new.userID
  FROM   dual;
END;

--8-----------------------------------------------------------------------------------------------------
--8 end ------------------------------------------------------------------------------------------------


--9-----------------------------------------------------------------------------------------------------
--9 end ------------------------------------------------------------------------------------------------



--10-----------------------------------------------------------------------------------------------------
--10 end ------------------------------------------------------------------------------------------------


--11-----------------------------------------------------------------------------------------------------
--11 end ------------------------------------------------------------------------------------------------



--12-----------------------------------------------------------------------------------------------------
--12 end ------------------------------------------------------------------------------------------------


--13-----------------------------------------------------------------------------------------------------
--13 end ------------------------------------------------------------------------------------------------


--14-----------------------------------------------------------------------------------------------------
--14 end ------------------------------------------------------------------------------------------------


--15-----------------------------------------------------------------------------------------------------
--15 end ------------------------------------------------------------------------------------------------


--16-----------------------------------------------------------------------------------------------------
--16 end ------------------------------------------------------------------------------------------------



--17-----------------------------------------------------------------------------------------------------
--17 end ------------------------------------------------------------------------------------------------


--18-----------------------------------------------------------------------------------------------------
--18 end ------------------------------------------------------------------------------------------------


--19-----------------------------------------------------------------------------------------------------
--19 end ------------------------------------------------------------------------------------------------


--20-----------------------------------------------------------------------------------------------------
--20 end ------------------------------------------------------------------------------------------------


--21-----------------------------------------------------------------------------------------------------
--21 end ------------------------------------------------------------------------------------------------


--22-----------------------------------------------------------------------------------------------------
--22 end ------------------------------------------------------------------------------------------------


--23-----------------------------------------------------------------------------------------------------
--23 end ------------------------------------------------------------------------------------------------


--24-----------------------------------------------------------------------------------------------------
--24 end ------------------------------------------------------------------------------------------------


--25-----------------------------------------------------------------------------------------------------
--25 end ------------------------------------------------------------------------------------------------


--26-----------------------------------------------------------------------------------------------------
--26 end ------------------------------------------------------------------------------------------------


--27-----------------------------------------------------------------------------------------------------
--27 end ------------------------------------------------------------------------------------------------


--28-----------------------------------------------------------------------------------------------------
--28 end ------------------------------------------------------------------------------------------------


--29-----------------------------------------------------------------------------------------------------
--29 end ------------------------------------------------------------------------------------------------


--30-----------------------------------------------------------------------------------------------------
--30 end ------------------------------------------------------------------------------------------------


--31-----------------------------------------------------------------------------------------------------
--31 end ------------------------------------------------------------------------------------------------


--32-----------------------------------------------------------------------------------------------------
--32 end ------------------------------------------------------------------------------------------------


--33-----------------------------------------------------------------------------------------------------
--33 end ------------------------------------------------------------------------------------------------









------------------------------------------------------
Drop table ChiNhanhSDT;
Drop table Chinhanh;


